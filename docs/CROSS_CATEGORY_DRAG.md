# 跨分类拖动功能

## 功能概述

在编辑模式下，支持将卡片在不同分类和子分类之间自由拖动，实现灵活的卡片归类和排序。

## 主要特性

### 1. 编辑模式视图切换
- **普通模式**：只展示当前选中的分类，保持简洁
- **编辑模式**：展示所有分类和子分类，方便跨分类操作

### 2. 跨分类拖动
- 使用 Sortable.js 的 `group` 功能实现跨容器拖动
- 所有分类共享同一拖动组 `'cards'`
- 拖动完成后自动更新卡片的 `menu_id` 和 `sub_menu_id`

### 3. 自动保存
- 拖动完成后静默保存，无需手动确认
- 保存失败时自动恢复原始顺序
- 实时更新所有分类的卡片数据

### 4. 视觉反馈
- 空分类显示"拖动卡片到此处"提示
- 拖动时的半透明预览效果
- 目标分类高亮边框提示

## 使用方法

### 进入编辑模式
1. 点击浮动按钮菜单中的"编辑模式"按钮
2. 输入管理员密码验证
3. 验证成功后，页面自动切换为编辑视图

### 拖动卡片
1. 在编辑模式下，所有卡片都可拖动
2. 鼠标按住卡片，拖动到目标分类
3. 松开鼠标，卡片自动归入目标分类
4. 系统自动保存更改

### 其他操作
- **编辑卡片**：点击卡片右上角的编辑按钮
- **删除卡片**：点击卡片右上角的删除按钮
- **退出编辑**：点击浮动菜单中的"退出编辑模式"按钮

## 技术实现

### 前端组件
- **Home.vue**：负责数据加载、视图切换、事件处理
- **CardGrid.vue**：负责渲染卡片、初始化拖动、触发事件

### 关键函数

#### Home.vue
```javascript
// 加载所有分类的卡片（编辑模式）
async function loadAllCards()

// 根据分类ID获取卡片
function getCategoryCards(menuId, subMenuId)

// 处理卡片排序更新
async function handleCardsReordered(cardIds, targetMenuId, targetSubMenuId)
```

#### CardGrid.vue
```javascript
// 初始化拖动功能
function initSortable()

// Props 新增
- categoryId: Number         // 当前分类ID
- subCategoryId: Number|null // 当前子分类ID
```

### 数据流
1. 用户拖动卡片
2. Sortable.js 触发 `onEnd` 事件
3. CardGrid emit `cardsReordered` 事件，传递卡片ID列表和目标分类ID
4. Home 接收事件，调用批量更新 API
5. 更新成功后重新加载所有分类数据

## 注意事项

1. **最小修改原则**：
   - 保留了普通模式的原有功能
   - 编辑模式仅新增展示方式，不影响其他功能
   - 拖动逻辑独立，不影响其他操作

2. **性能优化**：
   - 只在进入编辑模式时加载所有分类数据
   - 使用卡片ID而非完整对象传递数据
   - 拖动操作自动批量更新，减少请求次数

3. **用户体验**：
   - 静默保存，减少打扰
   - 失败时自动恢复，保证数据一致性
   - 视觉提示清晰，操作直观

## 样式说明

### 分类容器
- 半透明白色背景，毛玻璃效果
- 圆角边框，阴影效果
- 响应式布局适配移动端

### 空分类提示
- 虚线边框
- 半透明文字提示
- 自动显示在空分类底部

## 浏览器兼容性

- Chrome/Edge 90+
- Firefox 88+
- Safari 14+
- 移动端浏览器支持

## 已知限制

1. 不支持 IE 浏览器
2. 拖动动画在移动端可能不够流畅
3. 大量卡片时加载可能需要时间

## 未来改进

- [ ] 支持批量拖动多个卡片
- [ ] 添加拖动撤销/重做功能
- [ ] 优化移动端拖动体验
- [ ] 添加拖动操作的历史记录
