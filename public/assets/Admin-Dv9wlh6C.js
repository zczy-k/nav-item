var Q=Object.defineProperty,W=Object.defineProperties;var X=Object.getOwnPropertyDescriptors;var D=Object.getOwnPropertySymbols;var Y=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable;var N=(V,s,o)=>s in V?Q(V,s,{enumerable:!0,configurable:!0,writable:!0,value:o}):V[s]=o,F=(V,s)=>{for(var o in s||(s={}))Y.call(s,o)&&N(V,o,s[o]);if(D)for(var o of D(s))Z.call(s,o)&&N(V,o,s[o]);return V},P=(V,s)=>W(V,X(s));var y=(V,s,o)=>new Promise((u,a)=>{var g=$=>{try{f(o.next($))}catch(b){a(b)}},_=$=>{try{f(o.throw($))}catch(b){a(b)}},f=$=>$.done?u($.value):Promise.resolve($.value).then(g,_);f((o=o.apply(V,s)).next())});import{_ as z,r as m,g as T,c as h,o as v,b as e,w as k,v as M,q as S,F as I,a as L,n as A,t as B,e as R,y as E,z as j,j as G,d as x,A as O,l as q,B as ee,C as H,D as K}from"./index-CN3280sb.js";import{g as J,n as te,o as le,q as ne,r as se,s as oe,t as ae,v as ie,u as de,k as ue,d as re,a as ce,w as ve,x as pe,y as me,b as he,z as ge,A as be,B as we,C as ke,D as _e,l as fe}from"./api-DJSardu8.js";const $e={class:"menu-manage"},ye={class:"menu-header"},Me={class:"menu-add"},Ce={class:"menu-content"},Be={class:"menu-list"},Ve={class:"main-menu"},Ue={class:"menu-info"},xe=["onUpdate:modelValue","onBlur"],Ae={class:"menu-order"},Se=["onUpdate:modelValue","onBlur"],Ie={class:"menu-actions"},Le=["onClick","title"],ze=["onClick"],Te={class:"sub-menu-header"},He={class:"sub-menu-title"},Fe=["onClick"],Pe={key:0,class:"sub-menu-list"},je={class:"sub-menu-info"},De=["onUpdate:modelValue","onBlur"],Ne={class:"sub-menu-order"},Ee=["onUpdate:modelValue","onBlur"],Oe={class:"sub-menu-actions"},qe=["onClick"],Ke={key:1,class:"empty-sub-menu"},Re=["onClick"],Ge={__name:"MenuManage",setup(V){const s=m([]),o=m("");T(u);function u(){return y(this,null,function*(){const t=yield J();s.value=t.data.map(l=>P(F({},l),{showSubMenu:!1}))})}function a(){return y(this,null,function*(){if(!o.value.trim())return;const t=s.value.length?Math.max(...s.value.map(l=>l.order||0)):0;yield te({name:o.value.trim(),order:t+1}),o.value="",u()})}function g(t){return y(this,null,function*(){yield le(t.id,{name:t.name,order:t.order}),u()})}function _(t){return y(this,null,function*(){confirm("确定要删除这个主菜单吗？删除后将同时删除其下的所有子菜单和卡片。")&&(yield ne(t),u())})}function f(t){return y(this,null,function*(){var n;const l=s.value.find(d=>d.id===t),i=prompt("请输入子菜单名称：");if(!(i!=null&&i.trim()))return;const w=(n=l.subMenus)!=null&&n.length?Math.max(...l.subMenus.map(d=>d.order||0)):0;yield se(t,{name:i.trim(),order:w+1}),u()})}function $(t){return y(this,null,function*(){yield oe(t.id,{name:t.name,order:t.order}),u()})}function b(t){return y(this,null,function*(){confirm("确定要删除这个子菜单吗？删除后将同时删除其下的所有卡片。")&&(yield ae(t),u())})}function p(t){const l=s.value.find(i=>i.id===t);l&&(l.showSubMenu=!l.showSubMenu)}return(t,l)=>(v(),h("div",$e,[e("div",ye,[l[2]||(l[2]=e("div",{class:"header-content"},[e("h2",{class:"page-title"},"管理主菜单和子菜单")],-1)),e("div",Me,[k(e("input",{"onUpdate:modelValue":l[0]||(l[0]=i=>o.value=i),placeholder:"请输入主菜单名称",class:"input"},null,512),[[M,o.value]]),e("button",{class:"btn btn-primary",onClick:a},l[1]||(l[1]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M12 5v14M5 12h14"})],-1),S(" 添加主菜单 ")]))])]),e("div",Ce,[e("div",Be,[(v(!0),h(I,null,L(s.value,i=>{var w;return v(),h("div",{key:i.id,class:"menu-item"},[e("div",Ve,[e("div",Ue,[l[4]||(l[4]=e("div",{class:"menu-icon"},[e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M3 3h18v18H3zM9 9h6v6H9z"})])],-1)),k(e("input",{"onUpdate:modelValue":n=>i.name=n,onBlur:n=>g(i),class:"menu-name-input"},null,40,xe),[[M,i.name]]),e("div",Ae,[l[3]||(l[3]=e("span",{class:"order-label"},"排序",-1)),k(e("input",{"onUpdate:modelValue":n=>i.order=n,type:"number",onBlur:n=>g(i),class:"order-input"},null,40,Se),[[M,i.order,void 0,{number:!0}]])])]),e("div",Ie,[e("button",{class:"btn btn-icon expand-btn",onClick:n=>p(i.id),title:i.showSubMenu?"收起子菜单":"展开子菜单"},l[5]||(l[5]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"m6 9 6 6 6-6"})],-1)]),8,Le),e("button",{class:"btn btn-danger btn-icon",onClick:n=>_(i.id),title:"删除主菜单"},l[6]||(l[6]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M3 6h18M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"}),e("path",{d:"M10 11v6M14 11v6"})],-1)]),8,ze)])]),e("div",{class:A(["sub-menu-section",{expanded:i.showSubMenu}])},[e("div",Te,[e("div",He,[l[7]||(l[7]=e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M9 11H1l8-8 8 8h-8v8z"})],-1)),S(" 子菜单 ("+B(((w=i.subMenus)==null?void 0:w.length)||0)+") ",1)]),e("button",{class:"btn btn-sm btn-outline",onClick:n=>f(i.id)},l[8]||(l[8]=[e("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M12 5v14M5 12h14"})],-1),S(" 添加子菜单 ")]),8,Fe)]),i.subMenus&&i.subMenus.length>0?(v(),h("div",Pe,[(v(!0),h(I,null,L(i.subMenus,n=>(v(),h("div",{key:n.id,class:"sub-menu-item"},[e("div",je,[l[9]||(l[9]=e("div",{class:"sub-menu-icon"},[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M4 6h16M4 12h16M4 18h16"})])],-1)),k(e("input",{"onUpdate:modelValue":d=>n.name=d,onBlur:d=>$(n),class:"sub-menu-name-input"},null,40,De),[[M,n.name]]),e("div",Ne,[k(e("input",{"onUpdate:modelValue":d=>n.order=d,type:"number",onBlur:d=>$(n),class:"order-input"},null,40,Ee),[[M,n.order,void 0,{number:!0}]])])]),e("div",Oe,[e("button",{class:"btn btn-danger btn-icon btn-sm",onClick:d=>b(n.id),title:"删除子菜单"},l[10]||(l[10]=[e("svg",{width:"14",height:"14",viewBox:"0 0 22 22",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M3 6h18M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"}),e("path",{d:"M10 11v6M14 11v6"})],-1)]),8,qe)])]))),128))])):(v(),h("div",Ke,[l[11]||(l[11]=e("p",null,"暂无子菜单",-1)),e("button",{class:"btn btn-sm btn-outline",onClick:n=>f(i.id)},"添加第一个子菜单",8,Re)]))],2)])}),128))])])]))}},Je=z(Ge,[["__scopeId","data-v-5964fa59"]]),Qe={class:"card-manage"},We={class:"card-header"},Xe={class:"card-add"},Ye=["value"],Ze=["value"],et={class:"card-card"},tt={class:"card-table"},lt=["onUpdate:modelValue","onBlur"],nt=["onUpdate:modelValue","onBlur"],st=["onUpdate:modelValue","onBlur"],ot=["onUpdate:modelValue","onBlur"],at=["onUpdate:modelValue","onBlur"],it=["onClick"],dt={__name:"CardManage",setup(V){const s=m([]),o=m([]),u=m(),a=m(""),g=m(""),_=m(""),f=m(""),$=R(()=>{if(!u.value)return[];const n=s.value.find(d=>d.id===u.value);return(n==null?void 0:n.subMenus)||[]});T(()=>y(null,null,function*(){const n=yield J();s.value=n.data,s.value.length&&(u.value=s.value[0].id,a.value="")})),E(u,()=>{a.value="",t()}),E(a,t);function b(){a.value=""}function p(){t()}function t(){return y(this,null,function*(){if(!u.value)return;const n=yield re(u.value,a.value||null);o.value=n.data})}function l(){return y(this,null,function*(){!g.value||!_.value||(yield ie({menu_id:u.value,sub_menu_id:a.value||null,title:g.value,url:_.value,logo_url:f.value}),g.value="",_.value="",f.value="",t())})}function i(n){return y(this,null,function*(){yield de(n.id,{menu_id:u.value,sub_menu_id:a.value||null,title:n.title,url:n.url,logo_url:n.logo_url,desc:n.desc,order:n.order}),t()})}function w(n){return y(this,null,function*(){yield ue(n),t()})}return(n,d)=>(v(),h("div",Qe,[e("div",We,[d[7]||(d[7]=e("div",{class:"header-content"},[e("h2",{class:"page-title"},"管理网站导航卡片，支持主菜单和子菜单分类")],-1)),e("div",Xe,[k(e("select",{"onUpdate:modelValue":d[0]||(d[0]=r=>u.value=r),class:"input narrow",onChange:b},[(v(!0),h(I,null,L(s.value,r=>(v(),h("option",{value:r.id,key:r.id},B(r.name),9,Ye))),128))],544),[[j,u.value]]),k(e("select",{"onUpdate:modelValue":d[1]||(d[1]=r=>a.value=r),class:"input narrow",onChange:p},[d[5]||(d[5]=e("option",{value:""},"主菜单",-1)),(v(!0),h(I,null,L($.value,r=>(v(),h("option",{value:r.id,key:r.id},B(r.name),9,Ze))),128))],544),[[j,a.value]]),k(e("input",{"onUpdate:modelValue":d[2]||(d[2]=r=>g.value=r),placeholder:"卡片标题",class:"input narrow"},null,512),[[M,g.value]]),k(e("input",{"onUpdate:modelValue":d[3]||(d[3]=r=>_.value=r),placeholder:"卡片链接",class:"input wide"},null,512),[[M,_.value]]),k(e("input",{"onUpdate:modelValue":d[4]||(d[4]=r=>f.value=r),placeholder:"logo链接(可选)",class:"input wide"},null,512),[[M,f.value]]),e("button",{class:"btn",onClick:l},d[6]||(d[6]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M12 5v14M5 12h14"})],-1),S(" 添加卡片 ")]))])]),e("div",et,[e("table",tt,[d[9]||(d[9]=e("thead",null,[e("tr",null,[e("th",null,"标题"),e("th",null,"网址"),e("th",null,"Logo链接"),e("th",null,"描述"),e("th",null,"排序"),e("th",null,"操作")])],-1)),e("tbody",null,[(v(!0),h(I,null,L(o.value,r=>(v(),h("tr",{key:r.id},[e("td",null,[k(e("input",{"onUpdate:modelValue":C=>r.title=C,onBlur:C=>i(r),class:"table-input"},null,40,lt),[[M,r.title]])]),e("td",null,[k(e("input",{"onUpdate:modelValue":C=>r.url=C,onBlur:C=>i(r),class:"table-input"},null,40,nt),[[M,r.url]])]),e("td",null,[k(e("input",{"onUpdate:modelValue":C=>r.logo_url=C,onBlur:C=>i(r),class:"table-input",placeholder:"logo链接(可选)"},null,40,st),[[M,r.logo_url]])]),e("td",null,[k(e("input",{"onUpdate:modelValue":C=>r.desc=C,onBlur:C=>i(r),class:"table-input",placeholder:"描述（可选）"},null,40,ot),[[M,r.desc]])]),e("td",null,[k(e("input",{"onUpdate:modelValue":C=>r.order=C,type:"number",onBlur:C=>i(r),class:"table-input order-input"},null,40,at),[[M,r.order,void 0,{number:!0}]])]),e("td",null,[e("button",{class:"btn btn-danger btn-icon",onClick:C=>w(r.id),title:"删除"},d[8]||(d[8]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M3 6h18M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"}),e("path",{d:"M10 11v6M14 11v6"})],-1)]),8,it)])]))),128))])])])]))}},ut=z(dt,[["__scopeId","data-v-2003d901"]]),rt={class:"ad-manage"},ct={class:"ad-header"},vt={class:"ad-section"},pt={class:"ad-card"},mt={class:"ad-table"},ht=["onUpdate:modelValue","onBlur"],gt=["onUpdate:modelValue","onBlur"],bt=["onClick"],wt={class:"ad-section"},kt={class:"ad-card"},_t={class:"ad-table"},ft=["onUpdate:modelValue","onBlur"],$t=["onUpdate:modelValue","onBlur"],yt=["onClick"],Mt={__name:"AdManage",setup(V){const s=m([]),o=m([]),u=m(""),a=m(""),g=m("left");T(_);function _(){return y(this,null,function*(){const p=yield ce();s.value=p.data.filter(t=>t.position==="left"),o.value=p.data.filter(t=>t.position==="right")})}function f(){return y(this,null,function*(){!u.value||!a.value||(yield ve({position:g.value,img:u.value,url:a.value}),u.value="",a.value="",g.value="left",_())})}function $(p){return y(this,null,function*(){yield pe(p.id,{img:p.img,url:p.url}),_()})}function b(p){return y(this,null,function*(){yield me(p),_()})}return(p,t)=>(v(),h("div",rt,[e("div",ct,[e("form",{class:"ad-add-row",onSubmit:G(f,["prevent"])},[k(e("input",{"onUpdate:modelValue":t[0]||(t[0]=l=>u.value=l),placeholder:"广告图片链接",class:"input"},null,512),[[M,u.value]]),k(e("input",{"onUpdate:modelValue":t[1]||(t[1]=l=>a.value=l),placeholder:"广告跳转链接",class:"input"},null,512),[[M,a.value]]),k(e("select",{"onUpdate:modelValue":t[2]||(t[2]=l=>g.value=l),class:"input select-input"},t[3]||(t[3]=[e("option",{value:"left"},"左侧广告",-1),e("option",{value:"right"},"右侧广告",-1)]),512),[[j,g.value]]),t[4]||(t[4]=e("button",{class:"btn",type:"submit"},"添加广告",-1))],32)]),e("div",vt,[t[6]||(t[6]=e("h3",{class:"section-title"},"左侧广告列表",-1)),e("div",pt,[e("table",mt,[t[5]||(t[5]=e("thead",null,[e("tr",null,[e("th",null,"图片"),e("th",null,"跳转链接"),e("th",null,"操作")])],-1)),e("tbody",null,[(v(!0),h(I,null,L(s.value,l=>(v(),h("tr",{key:l.id},[e("td",null,[k(e("input",{"onUpdate:modelValue":i=>l.img=i,onBlur:i=>$(l),class:"input"},null,40,ht),[[M,l.img]])]),e("td",null,[k(e("input",{"onUpdate:modelValue":i=>l.url=i,onBlur:i=>$(l),class:"input"},null,40,gt),[[M,l.url]])]),e("td",null,[e("button",{class:"btn btn-danger",onClick:i=>b(l.id)},"删除广告",8,bt)])]))),128))])])])]),e("div",wt,[t[8]||(t[8]=e("h3",{class:"section-title"},"右侧广告列表",-1)),e("div",kt,[e("table",_t,[t[7]||(t[7]=e("thead",null,[e("tr",null,[e("th",null,"图片"),e("th",null,"跳转链接"),e("th",null,"操作")])],-1)),e("tbody",null,[(v(!0),h(I,null,L(o.value,l=>(v(),h("tr",{key:l.id},[e("td",null,[k(e("input",{"onUpdate:modelValue":i=>l.img=i,onBlur:i=>$(l),class:"input"},null,40,ft),[[M,l.img]])]),e("td",null,[k(e("input",{"onUpdate:modelValue":i=>l.url=i,onBlur:i=>$(l),class:"input"},null,40,$t),[[M,l.url]])]),e("td",null,[e("button",{class:"btn btn-danger",onClick:i=>b(l.id)},"删除广告",8,yt)])]))),128))])])])])]))}},Ct=z(Mt,[["__scopeId","data-v-780b5e23"]]),Bt={class:"friend-manage"},Vt={class:"friend-add"},Ut={class:"friend-card"},xt={class:"friend-table"},At=["onUpdate:modelValue","onBlur"],St=["onUpdate:modelValue","onBlur"],It=["onUpdate:modelValue","onBlur"],Lt=["onClick"],zt={__name:"FriendLinkManage",setup(V){const s=m([]),o=m(""),u=m(""),a=m("");T(g);function g(){return y(this,null,function*(){const b=yield he();s.value=b.data})}function _(){return y(this,null,function*(){!o.value||!u.value||(yield ge({title:o.value,url:u.value,logo:a.value}),o.value="",u.value="",a.value="",g())})}function f(b){return y(this,null,function*(){yield be(b.id,{title:b.title,url:b.url,logo:b.logo}),g()})}function $(b){return y(this,null,function*(){yield we(b),g()})}return(b,p)=>(v(),h("div",Bt,[p[4]||(p[4]=e("div",{class:"friend-header"},null,-1)),e("div",Vt,[k(e("input",{"onUpdate:modelValue":p[0]||(p[0]=t=>o.value=t),placeholder:"网站名",class:"input"},null,512),[[M,o.value]]),k(e("input",{"onUpdate:modelValue":p[1]||(p[1]=t=>u.value=t),placeholder:"网站链接",class:"input"},null,512),[[M,u.value]]),k(e("input",{"onUpdate:modelValue":p[2]||(p[2]=t=>a.value=t),placeholder:"logo链接(可选)",class:"input"},null,512),[[M,a.value]]),e("button",{class:"btn",onClick:_},"添加友链")]),e("div",Ut,[e("table",xt,[p[3]||(p[3]=e("thead",null,[e("tr",null,[e("th",null,"网站名"),e("th",null,"链接"),e("th",null,"Logo"),e("th",null,"操作")])],-1)),e("tbody",null,[(v(!0),h(I,null,L(s.value,t=>(v(),h("tr",{key:t.id},[e("td",null,[k(e("input",{"onUpdate:modelValue":l=>t.title=l,onBlur:l=>f(t),class:"input"},null,40,At),[[M,t.title]])]),e("td",null,[k(e("input",{"onUpdate:modelValue":l=>t.url=l,onBlur:l=>f(t),class:"input"},null,40,St),[[M,t.url]])]),e("td",null,[k(e("input",{"onUpdate:modelValue":l=>t.logo=l,onBlur:l=>f(t),class:"input",placeholder:"logo链接(可选)"},null,40,It),[[M,t.logo]])]),e("td",null,[e("button",{class:"btn btn-danger",onClick:l=>$(t.id)},"删除",8,Lt)])]))),128))])])])]))}},Tt=z(zt,[["__scopeId","data-v-f280329a"]]),Ht={class:"user-manage"},Ft={class:"user-card"},Pt={class:"password-section"},jt={class:"password-form"},Dt={class:"form-group"},Nt={class:"form-group"},Et={class:"form-group"},Ot={class:"form-actions"},qt=["disabled"],Kt={__name:"UserManage",setup(V){const s=m(""),o=m(""),u=m(""),a=m(!1),g=m(""),_=m("success"),f=m({});T(()=>y(null,null,function*(){try{const p=yield ke();f.value=p.data}catch(p){console.error("获取用户信息失败:",p)}}));function $(){return y(this,null,function*(){var p,t;if(!s.value||!o.value||!u.value){b("请填写所有密码字段","error");return}if(o.value!==u.value){b("两次输入的新密码不一致","error");return}if(o.value.length<6){b("新密码长度至少6位","error");return}a.value=!0,g.value="";try{yield _e(s.value,o.value),b("密码修改成功","success"),s.value="",o.value="",u.value=""}catch(l){b(((t=(p=l.response)==null?void 0:p.data)==null?void 0:t.message)||"密码修改失败","error")}finally{a.value=!1}})}function b(p,t){g.value=p,_.value=t,p==="密码修改成功"&&t==="success"?setTimeout(()=>{g.value="2秒后自动退出登录,请使用新密码重新登录...",setTimeout(()=>{localStorage.removeItem("token"),window.location.reload()},2e3)},500):setTimeout(()=>{g.value=""},3e3)}return(p,t)=>(v(),h("div",Ht,[t[7]||(t[7]=e("div",{class:"user-header"},null,-1)),e("div",Ft,[e("div",Pt,[t[6]||(t[6]=e("h3",{class:"section-title"},"修改密码",-1)),e("div",jt,[e("div",Dt,[t[3]||(t[3]=e("label",null,"当前密码：",-1)),k(e("input",{"onUpdate:modelValue":t[0]||(t[0]=l=>s.value=l),type:"password",placeholder:"请输入当前密码",class:"input"},null,512),[[M,s.value]])]),e("div",Nt,[t[4]||(t[4]=e("label",null,"新密码：",-1)),k(e("input",{"onUpdate:modelValue":t[1]||(t[1]=l=>o.value=l),type:"password",placeholder:"请输入新密码",class:"input"},null,512),[[M,o.value]])]),e("div",Et,[t[5]||(t[5]=e("label",null,"确认新密码：",-1)),k(e("input",{"onUpdate:modelValue":t[2]||(t[2]=l=>u.value=l),type:"password",placeholder:"请再次输入新密码",class:"input"},null,512),[[M,u.value]])]),e("div",Ot,[e("button",{onClick:$,class:"btn",disabled:a.value},B(a.value?"修改中...":"修改密码"),9,qt)]),g.value?(v(),h("p",{key:0,class:A(["message",_.value])},B(g.value),3)):x("",!0)])])])]))}},Rt=z(Kt,[["__scopeId","data-v-85ce40f4"]]),Gt={class:"backup-manage"},Jt={class:"toolbar"},Qt=["disabled"],Wt=["disabled"],Xt={class:"backup-list"},Yt={key:0,class:"empty-state"},Zt={key:1,class:"backup-grid"},el={class:"backup-info"},tl={class:"backup-name"},ll={class:"backup-meta"},nl={class:"backup-size"},sl={class:"backup-date"},ol={class:"backup-actions"},al=["onClick"],il=["onClick"],dl=["onClick"],ul={key:1,class:"modal-overlay"},rl={class:"modal-content"},cl={class:"modal-actions"},vl={__name:"BackupManage",setup(V){const s=m([]),o=O({create:!1,list:!1,delete:!1,restore:!1}),u=m({text:"",type:""}),a=O({show:!1,filename:"",action:null,title:"",confirmClass:""}),g=localStorage.getItem("token");function _(d){return y(this,arguments,function*(w,n={}){return(yield fetch(w,P(F({},n),{headers:F({Authorization:`Bearer ${g}`,"Content-Type":"application/json"},n.headers)}))).json()})}const f=(w,n="success")=>{u.value={text:w,type:n},setTimeout(()=>{u.value={text:"",type:""}},3e3)},$=()=>y(null,null,function*(){o.create=!0;const w=yield _("/api/backup/create",{method:"POST"});w.success?(f("备份创建成功！"),yield b()):f(w.message||"备份创建失败","error"),o.create=!1}),b=()=>y(null,null,function*(){o.list=!0;const w=yield _("/api/backup/list");w.success?s.value=w.backups:f("获取备份列表失败","error"),o.list=!1}),p=w=>{window.open(`/api/backup/download/${w}?token=${g}`,"_blank")},t=(w,n)=>{a.show=!0,a.filename=n,a.action=w,a.title=w==="delete"?"删除":"恢复",a.confirmClass=w==="delete"?"btn-danger":"btn-restore"},l=()=>y(null,null,function*(){const{action:w,filename:n}=a;a.show=!1,o[w]=!0;let d;w==="delete"?d=yield _(`/api/backup/delete/${n}`,{method:"DELETE"}):w==="restore"&&(d=yield _(`/api/backup/restore/${n}`,{method:"POST"})),d.success?(f(`${a.title}成功！`),yield b()):f(d.message||`${a.title}失败`,"error"),o[w]=!1}),i=w=>w?new Date(w).toLocaleString("zh-CN",{hour12:!1}):"--";return T(()=>{b()}),(w,n)=>(v(),h("div",Gt,[e("div",Jt,[e("button",{class:"btn btn-primary",onClick:$,disabled:o.create},[n[1]||(n[1]=e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M17 8l-5-5-5 5M12 3v12"})],-1)),S(" "+B(o.create?"备份中...":"创建备份"),1)],8,Qt),e("button",{class:"btn btn-secondary",onClick:b,disabled:o.list},[n[2]||(n[2]=e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M1 4v6h6M23 20v-6h-6"}),e("path",{d:"M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"})],-1)),S(" "+B(o.list?"刷新中...":"刷新列表"),1)],8,Wt)]),u.value.text?(v(),h("div",{key:0,class:A(["message",u.value.type])},B(u.value.text),3)):x("",!0),e("div",Xt,[s.value.length===0&&!o.list?(v(),h("div",Yt,n[3]||(n[3]=[e("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"#ccc","stroke-width":"1.5"},[e("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),e("circle",{cx:"12",cy:"7",r:"4"})],-1),e("p",null,"暂无备份文件",-1)]))):(v(),h("div",Zt,[(v(!0),h(I,null,L(s.value,d=>(v(),h("div",{key:d.name,class:"backup-card"},[n[7]||(n[7]=e("div",{class:"backup-icon"},[e("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"#2566d8","stroke-width":"2"},[e("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),e("polyline",{points:"14 2 14 8 20 8"})])],-1)),e("div",el,[e("div",tl,B(d.name),1),e("div",ll,[e("span",nl,B(d.size),1),e("span",sl,B(i(d.created)),1)])]),e("div",ol,[e("button",{class:"btn-icon btn-restore",onClick:r=>t("restore",d.name),title:"恢复备份"},n[4]||(n[4]=[e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M1 4v6h6M23 20v-6h-6"}),e("path",{d:"M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"})],-1)]),8,al),e("button",{class:"btn-icon",onClick:r=>p(d.name),title:"下载备份"},n[5]||(n[5]=[e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"})],-1)]),8,il),e("button",{class:"btn-icon btn-danger",onClick:r=>t("delete",d.name),title:"删除备份"},n[6]||(n[6]=[e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polyline",{points:"3 6 5 6 21 6"}),e("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})],-1)]),8,dl)])]))),128))]))]),a.show?(v(),h("div",ul,[e("div",rl,[e("h3",null,"确认"+B(a.title),1),e("p",null,[S("确定要"+B(a.title)+"备份文件 ",1),e("strong",null,B(a.filename),1),n[8]||(n[8]=S(" 吗？"))]),e("div",cl,[e("button",{class:"btn btn-secondary",onClick:n[0]||(n[0]=d=>a.show=!1)},"取消"),e("button",{class:A(["btn",a.confirmClass]),onClick:l},"确认",2)])])])):x("",!0)]))}},pl=z(vl,[["__scopeId","data-v-ed242e45"]]),ml={key:0,class:"login-container"},hl={class:"login-card"},gl={class:"login-form"},bl={class:"password-input-wrapper"},wl=["type"],kl={key:0,width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"#2566d8","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},_l={key:1,width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"#2566d8","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},fl={class:"login-buttons"},$l=["disabled"],yl={key:0,class:"login-error"},Ml={key:1,class:"admin-layout"},Cl={class:"menu-list"},Bl={class:"admin-main"},Vl={class:"admin-header"},Ul={class:"header-title"},xl={class:"admin-content"},Al={key:0,class:"welcome-page"},Sl={class:"welcome-cards"},Il={class:"welcome-card"},Ll={class:"welcome-value"},zl={class:"welcome-card"},Tl={class:"welcome-value"},Hl={__name:"Admin",setup(V){const s=m("welcome"),o=m(""),u=m(""),a=m(!1),g=m(""),_=m(""),f=m(!1),$=m(""),b=m(!1),p=m(!1),t=R(()=>{switch(s.value){case"menu":return"栏目管理";case"card":return"卡片管理";case"ad":return"广告管理";case"friend":return"友链管理";case"user":return"用户管理";case"backup":return"备份管理";default:return""}});T(()=>{const C=localStorage.getItem("token");a.value=!!C,a.value&&l()});function l(){return y(this,null,function*(){try{const C=yield fetch("/api/users/me",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(C.ok){const c=yield C.json();o.value=c.last_login_time||"",u.value=c.last_login_ip||""}}catch(C){console.error("获取用户信息失败:",C)}})}function i(){return y(this,null,function*(){var C,c;if(!g.value||!_.value){$.value="请输入用户名和密码";return}f.value=!0,$.value="";try{const U=yield fe(g.value,_.value);U.data.token&&(localStorage.setItem("token",U.data.token),a.value=!0,o.value=U.data.lastLoginTime||"",u.value=U.data.lastLoginIp||"")}catch(U){$.value=((c=(C=U.response)==null?void 0:C.data)==null?void 0:c.message)||"登录失败，请检查用户名和密码"}finally{f.value=!1}})}function w(){localStorage.removeItem("token"),a.value=!1,g.value="",_.value="",$.value=""}function n(){window.open("/","_blank")}function d(){p.value=!p.value}function r(){p.value=!1}return(C,c)=>a.value?(v(),h("div",Ml,[e("aside",{class:A(["admin-sider",{open:p.value}]),onClick:G(r,["self"])},[e("div",{class:"logo clickable",onClick:c[3]||(c[3]=U=>{s.value="welcome",r()})},"Admin"),e("ul",Cl,[e("li",{class:A({active:s.value==="menu"}),onClick:c[4]||(c[4]=U=>{s.value="menu",r()})},"栏目管理",2),e("li",{class:A({active:s.value==="card"}),onClick:c[5]||(c[5]=U=>{s.value="card",r()})},"卡片管理",2),e("li",{class:A({active:s.value==="ad"}),onClick:c[6]||(c[6]=U=>{s.value="ad",r()})},"广告管理",2),e("li",{class:A({active:s.value==="friend"}),onClick:c[7]||(c[7]=U=>{s.value="friend",r()})},"友链管理",2),e("li",{class:A({active:s.value==="user"}),onClick:c[8]||(c[8]=U=>{s.value="user",r()})},"用户管理",2),e("li",{class:A({active:s.value==="backup"}),onClick:c[9]||(c[9]=U=>{s.value="backup",r()})},"备份管理",2)])],2),e("main",Bl,[e("div",Vl,[e("button",{class:"menu-toggle",onClick:d}," ☰ "),e("div",Ul,B(t.value),1),e("div",{class:"header-actions"},[e("span",{class:"home-icon",onClick:n,title:"进入主页"},c[14]||(c[14]=[e("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none"},[e("path",{d:"M3 10.5L12 4l9 6.5V20a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1v-4h-4v4a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V10.5z",stroke:"#2566d8","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])),e("button",{class:"btn logout-btn",onClick:w},"退出登录")])]),e("div",xl,[s.value==="welcome"?(v(),h("div",Al,[c[17]||(c[17]=e("h2",{class:"welcome-title"},"欢迎您进入 Con-Nav-Item 后台管理系统",-1)),e("div",Sl,[e("div",Il,[c[15]||(c[15]=K('<div class="welcome-icon time-icon" data-v-3d6ed9cb><svg width="32" height="32" viewBox="0 0 24 24" fill="none" data-v-3d6ed9cb><circle cx="12" cy="12" r="10" stroke="#1abc9c" stroke-width="2" data-v-3d6ed9cb></circle><path d="M12 6v6l4 2" stroke="#1abc9c" stroke-width="2" stroke-linecap="round" data-v-3d6ed9cb></path></svg></div><div class="welcome-label" data-v-3d6ed9cb>上次登录时间</div>',2)),e("div",Ll,B(o.value||"--"),1)]),e("div",zl,[c[16]||(c[16]=K('<div class="welcome-icon ip-icon" data-v-3d6ed9cb><svg width="32" height="32" viewBox="0 0 24 24" fill="none" data-v-3d6ed9cb><circle cx="12" cy="12" r="10" stroke="#1abc9c" stroke-width="2" data-v-3d6ed9cb></circle><path d="M12 8a4 4 0 1 1 0 8 4 4 0 0 1 0-8z" stroke="#1abc9c" stroke-width="2" data-v-3d6ed9cb></path><circle cx="12" cy="12" r="2" fill="#1abc9c" data-v-3d6ed9cb></circle></svg></div><div class="welcome-label" data-v-3d6ed9cb>上次登录IP</div>',2)),e("div",Tl,B(u.value||"--"),1)])])])):x("",!0),s.value==="menu"?(v(),H(Je,{key:1})):x("",!0),s.value==="card"?(v(),H(ut,{key:2})):x("",!0),s.value==="ad"?(v(),H(Ct,{key:3})):x("",!0),s.value==="friend"?(v(),H(Tt,{key:4})):x("",!0),s.value==="user"?(v(),H(Rt,{key:5})):x("",!0),s.value==="backup"?(v(),H(pl,{key:6})):x("",!0)]),c[18]||(c[18]=e("footer",{class:"admin-footer"},[e("p",{class:"admin-copyright"},[S("Copyright © 2025 Con-Nav-Item | "),e("a",{href:"https://github.com/zczy-k/Con-Nav-Item",target:"_blank",class:"footer-link"},"Powered by zczy-k")])],-1))])])):(v(),h("div",ml,[e("div",hl,[c[13]||(c[13]=e("h2",{class:"login-title"},"后台管理登录",-1)),e("div",gl,[k(e("input",{"onUpdate:modelValue":c[0]||(c[0]=U=>g.value=U),type:"text",placeholder:"用户名",class:"login-input",onKeyup:q(i,["enter"])},null,544),[[M,g.value]]),e("div",bl,[k(e("input",{"onUpdate:modelValue":c[1]||(c[1]=U=>_.value=U),type:b.value?"text":"password",placeholder:"密码",class:"login-input password-input",onKeyup:q(i,["enter"])},null,40,wl),[[ee,_.value]]),e("span",{class:"toggle-password",onClick:c[2]||(c[2]=U=>b.value=!b.value)},[b.value?(v(),h("svg",kl,c[10]||(c[10]=[e("path",{d:"M1 12s4-7 11-7 11 7 11 7-4 7-11 7S1 12 1 12z"},null,-1),e("circle",{cx:"12",cy:"12",r:"3"},null,-1)]))):(v(),h("svg",_l,c[11]||(c[11]=[e("path",{d:"M17.94 17.94A10.94 10.94 0 0 1 12 19c-7 0-11-7-11-7a21.77 21.77 0 0 1 5.06-6.06"},null,-1),e("path",{d:"M1 1l22 22"},null,-1),e("path",{d:"M9.53 9.53A3 3 0 0 0 12 15a3 3 0 0 0 2.47-5.47"},null,-1)])))])]),e("div",fl,[e("button",{onClick:n,class:"back-btn"},c[12]||(c[12]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M19 12H5M12 19l-7-7 7-7"})],-1),S(" 返回首页 ")])),e("button",{onClick:i,class:"login-btn",disabled:f.value},B(f.value?"登录中...":"登录"),9,$l)]),$.value?(v(),h("p",yl,B($.value),1)):x("",!0)])])]))}},Dl=z(Hl,[["__scopeId","data-v-3d6ed9cb"]]);export{Dl as default};
