# 管理后台备份功能使用说明

## 功能概述

管理后台新增了**备份管理**功能，可通过可视化界面直接进行数据备份、下载、查看和删除操作。

## 如何使用

### 1. 访问备份管理页面

1. 登录管理后台 `/admin`
2. 在左侧菜单栏点击 **"备份管理"**

### 2. 创建备份

- 点击页面顶部的 **"创建备份"** 按钮
- 系统会自动备份以下内容：
  - 📁 `database/` - 所有数据库文件
  - 📁 `uploads/` - 所有上传的图片文件
  - 📄 `.env` - 环境配置文件
  - 📄 `backup-info.json` - 备份信息文件
- 备份完成后会显示成功提示，并自动刷新备份列表

### 3. 查看备份列表

备份列表会显示：
- 📦 备份文件名（格式：`backup-YYYY-MM-DDTHH-MM-SS.zip`）
- 📊 文件大小（单位：MB）
- 📅 创建时间

### 4. 下载备份

- 点击备份卡片右侧的 **下载图标**（向下箭头）
- 备份文件会自动下载到本地

### 5. 删除备份

- 点击备份卡片右侧的 **删除图标**（垃圾桶）
- 在弹出的确认对话框中点击 **"确认删除"**
- 删除成功后自动刷新列表

### 6. 刷新列表

- 点击页面顶部的 **"刷新列表"** 按钮
- 重新加载最新的备份列表

## 备份存储位置

所有备份文件存储在：
```
项目根目录/backups/
```

## 技术细节

### 备份文件结构

```
backup-2025-01-31T12-30-45.zip
├── database/
│   └── nav.db
├── uploads/
│   └── [上传的图片文件]
├── .env
└── backup-info.json
```

### API 端点

- `POST /api/backup/create` - 创建备份
- `GET /api/backup/list` - 获取备份列表
- `GET /api/backup/download/:filename` - 下载备份
- `DELETE /api/backup/delete/:filename` - 删除备份

所有端点都需要管理员身份验证（JWT Token）。

## 恢复备份

### 手动恢复方式

1. 下载备份文件到本地
2. 解压备份文件
3. 停止应用服务
4. 将解压后的文件覆盖到项目对应目录：
   ```bash
   # 恢复数据库
   cp -r backup/database/* /path/to/project/database/
   
   # 恢复上传文件
   cp -r backup/uploads/* /path/to/project/uploads/
   
   # 恢复环境配置
   cp backup/.env /path/to/project/.env
   ```
5. 重启应用服务

### 使用脚本恢复（推荐）

继续使用已有的备份管理脚本：
```bash
bash scripts/backup-manager.sh
# 选择选项 3：恢复本地备份
```

## 注意事项

⚠️ **重要提示：**

1. **定期备份**：建议每天或每周定期创建备份
2. **本地保存**：重要备份应下载到本地保管
3. **空间管理**：定期清理旧备份，释放服务器空间
4. **恢复测试**：定期测试备份恢复流程，确保备份有效
5. **权限保护**：备份功能仅管理员可访问

## 安装依赖

如果是首次使用备份功能，需要安装 `archiver` 依赖：

```bash
npm install archiver
```

或使用 yarn：

```bash
yarn add archiver
```

## 故障排除

### 问题：创建备份失败

**解决方案：**
1. 检查服务器磁盘空间是否充足
2. 检查 `backups` 目录是否有写入权限
3. 查看服务器日志获取详细错误信息

### 问题：下载备份失败

**解决方案：**
1. 检查备份文件是否存在
2. 确认已登录管理后台（Token 有效）
3. 检查浏览器下载设置

### 问题：备份列表为空

**解决方案：**
1. 先创建一个备份
2. 检查 `backups` 目录是否存在
3. 点击刷新列表按钮

## 与命令行备份工具对比

| 特性 | 管理后台备份 | 命令行脚本备份 |
|------|-------------|---------------|
| 使用方式 | 可视化界面 | 命令行交互 |
| 创建备份 | ✅ 一键创建 | ✅ 支持 |
| 查看列表 | ✅ 图形化显示 | ✅ 文本列表 |
| 下载备份 | ✅ 浏览器下载 | ❌ 需 SCP |
| GitHub备份 | ❌ 不支持 | ✅ 支持 |
| 定时任务 | ❌ 需配置 | ✅ 内置支持 |
| 恢复备份 | ⚠️ 手动恢复 | ✅ 自动恢复 |

**建议：**
- 日常备份：使用管理后台，快捷方便
- 迁移/定时：使用命令行脚本，功能更全

## 更多帮助

- 查看完整备份指南：[BACKUP.md](./BACKUP.md)
- 项目文档：https://github.com/zczy-k/Con-Nav-Item
- 问题反馈：https://github.com/zczy-k/Con-Nav-Item/issues
